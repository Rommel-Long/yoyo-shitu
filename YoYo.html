<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width,initial-scale=1,viewport-fit=cover,user-scalable=no"
    />
    <title>å®å®ç»˜æœ¬å¢™ï¼šA-Z ç…§ç‰‡ç‰ˆï¼ˆç»ˆæç‰ˆï¼šå¤œé—´/å®Œæˆå¥–åŠ±/å¾…æœº/å®å®å¡ï¼‰</title>
    <style>
      :root {
        --ink: rgba(30, 36, 46, 0.88);
        --paper: rgba(255, 250, 240, 0.16);
        --paper2: rgba(255, 250, 240, 0.1);
      }
      html,
      body {
        height: 100%;
        margin: 0;
        overflow: hidden;
        background: #081028;
        font-family: system-ui, -apple-system, "PingFang SC", "Microsoft YaHei",
          sans-serif;
      }
      /* === ç²‰è‰²ç»˜æœ¬èƒŒæ™¯ï¼ˆå°‘å¥³é£ï¼‰ === */
      .bg {
        position: fixed;
        inset: 0;
        background: radial-gradient(
            circle at 20% 15%,
            rgba(255, 210, 230, 0.55),
            transparent 45%
          ),
          radial-gradient(
            circle at 80% 20%,
            rgba(255, 230, 245, 0.55),
            transparent 48%
          ),
          radial-gradient(
            circle at 50% 85%,
            rgba(255, 200, 220, 0.45),
            transparent 50%
          ),
          linear-gradient(180deg, #fff0f6 0%, #ffe4ef 45%, #ffd6e8 100%);
      }

      .page {
        position: fixed;
        inset: 14px;
        border-radius: 28px;
        background: linear-gradient(135deg, var(--paper), var(--paper2));
        border: 2px solid rgba(255, 255, 255, 0.14);
        box-shadow: 0 18px 40px rgba(0, 0, 0, 0.28);
        overflow: hidden;
      }
      .page::before {
        content: "";
        position: absolute;
        inset: 0;
        background-image: radial-gradient(
            rgba(255, 255, 255, 0.1) 1px,
            transparent 1px
          ),
          radial-gradient(rgba(0, 0, 0, 0.1) 1px, transparent 1px);
        background-size: 18px 18px, 22px 22px;
        background-position: 0 0, 9px 11px;
        opacity: 0.1;
        pointer-events: none;
      }
      .cornerTag {
        position: absolute;
        right: 14px;
        bottom: 14px;
        padding: 10px 14px;
        border-radius: 999px;
        background: rgba(255, 255, 255, 0.18);
        border: 2px solid rgba(30, 36, 46, 0.18);
        color: rgba(30, 36, 46, 0.78);
        font-weight: 700;
        user-select: none;
        pointer-events: none;
        z-index: 5;
      }

      .hud {
        position: fixed;
        left: 12px;
        right: 12px;
        top: 12px;
        display: flex;
        gap: 10px;
        align-items: center;
        justify-content: space-between;
        z-index: 20;
        pointer-events: none;
        flex-wrap: wrap;
      }
      .pill,
      .progressWrap {
        pointer-events: auto;
        background: rgba(255, 255, 255, 0.1);
        border: 1px solid rgba(255, 255, 255, 0.18);
        color: rgba(255, 255, 255, 0.92);
        padding: 10px 12px;
        border-radius: 999px;
        backdrop-filter: blur(8px);
        -webkit-backdrop-filter: blur(8px);
        display: flex;
        align-items: center;
        gap: 10px;
        box-shadow: 0 8px 24px rgba(0, 0, 0, 0.25);
        user-select: none;
        -webkit-user-select: none;
      }

      /* âœ… æŒ‰é’®æ›´æ¸…æ™°ï¼šè“æœç²‰å¡é€šæŒ‰é’® */
      .pill button {
        appearance: none;
        border: none;
        cursor: pointer;

        background: linear-gradient(
          180deg,
          rgba(255, 210, 230, 0.95),
          rgba(255, 170, 205, 0.92)
        );
        color: rgba(120, 30, 70, 0.96);

        padding: 10px 14px;
        border-radius: 999px;
        font-size: 14px;
        font-weight: 900;
        letter-spacing: 0.3px;

        box-shadow: 0 10px 18px rgba(255, 120, 170, 0.22),
          0 8px 18px rgba(0, 0, 0, 0.14);

        border: 2px solid rgba(255, 255, 255, 0.6);
        text-shadow: 0 1px 0 rgba(255, 255, 255, 0.45);
      }
      .pill button:active {
        transform: scale(0.98);
      }
      body.night .pill button {
        background: linear-gradient(
          180deg,
          rgba(255, 190, 220, 0.95),
          rgba(255, 150, 200, 0.92)
        );
      }

      .pill label {
        font-size: 14px;
        opacity: 0.95;
      }
      .pill input[type="range"] {
        width: 120px;
      }

      .progressWrap {
        min-width: 220px;
      }
      .bar {
        height: 10px;
        flex: 1;
        background: rgba(255, 255, 255, 0.12);
        border: 1px solid rgba(255, 255, 255, 0.14);
        border-radius: 999px;
        overflow: hidden;
      }
      .bar > i {
        display: block;
        height: 100%;
        width: 0%;
        background: rgba(255, 255, 255, 0.55);
        border-radius: 999px;
        transition: width 0.25s ease;
      }
      .count {
        font-size: 13px;
        opacity: 0.95;
        white-space: nowrap;
      }

      .hint {
        position: fixed;
        inset: 0;
        display: flex;
        align-items: center;
        justify-content: center;
        flex-direction: column;
        color: rgba(255, 255, 255, 0.82);
        text-align: center;
        font-size: 20px;
        line-height: 1.4;
        padding: 24px;
        text-shadow: 0 10px 30px rgba(0, 0, 0, 0.35);
        transition: opacity 0.35s ease;
        pointer-events: none;
        z-index: 15;
      }
      .hint.hidden {
        opacity: 0;
      }
      .hint small {
        opacity: 0.8;
        font-size: 14px;
        margin-top: 10px;
      }

      .badge {
        position: fixed;
        left: 50%;
        bottom: 18px;
        transform: translateX(-50%);
        background: rgba(255, 255, 255, 0.1);
        border: 1px solid rgba(255, 255, 255, 0.16);
        color: rgba(255, 255, 255, 0.9);
        padding: 10px 14px;
        border-radius: 999px;
        font-size: 14px;
        backdrop-filter: blur(8px);
        -webkit-backdrop-filter: blur(8px);
        box-shadow: 0 8px 24px rgba(0, 0, 0, 0.25);
        opacity: 0;
        transition: opacity 0.25s ease;
        pointer-events: none;
        max-width: 92vw;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
        z-index: 20;
      }
      .badge.show {
        opacity: 1;
      }

      .grid {
        position: absolute;
        left: 22px;
        right: 22px;
        top: 86px;
        bottom: 66px;
        display: grid;
        grid-template-columns: repeat(5, minmax(0, 1fr));
        grid-template-rows: repeat(6, minmax(0, 1fr));
        gap: 16px;
        padding: 10px;
      }

      .slot {
        position: relative;
        border-radius: 22px;
        border: 2px dashed rgba(30, 36, 46, 0.18);
        background: rgba(255, 255, 255, 0.02);
        overflow: visible;
      }

      .card {
        position: absolute;
        inset: 0;
        border-radius: 22px;
        background: rgba(255, 255, 255, 0.1);
        border: 3px solid rgba(255, 255, 255, 0.22);
        box-shadow: 0 16px 30px rgba(255, 160, 190, 0.18),
          0 10px 20px rgba(0, 0, 0, 0.18);
        overflow: hidden;
        display: none;
        cursor: pointer;
        transform: scale(1);
        transition: transform 220ms ease, filter 220ms ease, opacity 220ms ease;
        will-change: transform, filter, opacity;
      }
      .card.show {
        display: block;
      }

      .card.pop {
        animation: popIn 520ms cubic-bezier(0.2, 0.9, 0.2, 1) both;
      }
      @keyframes popIn {
        0% {
          transform: scale(0.92);
        }
        55% {
          transform: scale(1.06);
        }
        100% {
          transform: scale(1);
        }
      }

      .grid.dim .card.show {
        opacity: 0.55;
        filter: saturate(0.95) brightness(0.92);
      }
      .grid.dim .card.show.active {
        opacity: 1;
        filter: none;
        transform: scale(1.04);
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.35);
        border-color: rgba(255, 255, 255, 0.35);
        z-index: 4;
      }

      .card.zoom {
        transform: scale(1.2) !important;
        z-index: 50;
      }

      .cardInner {
        position: absolute;
        inset: 6px;
        border-radius: 18px;
        border: 2px solid rgba(255, 255, 255, 0.22);
        overflow: hidden;
        background: rgba(255, 255, 255, 0.06);
      }

      .photo {
        position: absolute;
        inset: 0;
        width: 100%;
        height: 100%;
        object-fit: cover;
        transform: scale(1.06);
        z-index: 1;
      }

      .missingMsg {
        position: absolute;
        inset: 0;
        z-index: 2;
        display: none;
        align-items: center;
        justify-content: center;
        padding: 14px;
        white-space: pre-wrap;
        text-align: left;
        font-weight: 800;
        color: rgba(30, 36, 46, 0.78);
        background: linear-gradient(
          135deg,
          rgba(255, 255, 255, 0.16),
          rgba(255, 255, 255, 0.08)
        );
      }
      .missingMsg.show {
        display: flex;
      }

      .letterTag {
        position: absolute;
        left: 10px;
        top: 10px;
        padding: 8px 10px;
        border-radius: 999px;
        background: rgba(255, 255, 255, 0.62);
        border: 2px solid rgba(30, 36, 46, 0.28);
        color: rgba(30, 36, 46, 0.86);
        font-weight: 900;
        min-width: 44px;
        text-align: center;
        z-index: 3;
      }

      .nameTag {
        position: absolute;
        left: 14%;
        right: 14%;
        bottom: 10px;
        padding: 8px 10px;
        border-radius: 999px;
        background: rgba(255, 255, 255, 0.62);
        border: 2px solid rgba(30, 36, 46, 0.28);
        color: rgba(30, 36, 46, 0.86);
        font-weight: 800;
        text-align: center;
        font-size: 14px;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
        z-index: 3;
      }

      .tape {
        position: absolute;
        top: -8px;
        left: 10px;
        width: 34%;
        height: 16px;
        border-radius: 999px;
        background: rgba(255, 255, 255, 0.26);
        border: 2px solid rgba(30, 36, 46, 0.16);
        transform: rotate(-2deg);
        pointer-events: none;
        z-index: 3;
      }
      .tape.r {
        left: auto;
        right: 10px;
        transform: rotate(4deg);
        width: 30%;
        background: rgba(255, 255, 255, 0.2);
      }

      .overlay {
        position: fixed;
        inset: 0;
        display: none;
        align-items: center;
        justify-content: center;
        padding: 18px;
        z-index: 999;
        background: rgba(0, 0, 0, 0.45);
        backdrop-filter: blur(6px);
        -webkit-backdrop-filter: blur(6px);
        transition: opacity 450ms ease;
        opacity: 0;
      }
      .overlay.show {
        display: flex;
        opacity: 1;
      }
      .overlay.fade {
        opacity: 0;
      }

      .bigBook {
        width: min(92vw, 980px);
        height: min(86vh, 760px);
        border-radius: 28px;
        background: linear-gradient(
          135deg,
          rgba(255, 250, 240, 0.18),
          rgba(255, 250, 240, 0.1)
        );
        border: 2px solid rgba(255, 255, 255, 0.18);
        box-shadow: 0 30px 80px rgba(0, 0, 0, 0.45);
        position: relative;
        overflow: hidden;
        transform: scale(0.98);
        animation: bigPop 360ms cubic-bezier(0.2, 0.9, 0.2, 1) both;
      }
      @keyframes bigPop {
        0% {
          transform: scale(0.95);
        }
        70% {
          transform: scale(1.02);
        }
        100% {
          transform: scale(1);
        }
      }
      .bigBook::before {
        content: "";
        position: absolute;
        inset: 0;
        background-image: radial-gradient(
            rgba(255, 255, 255, 0.1) 1px,
            transparent 1px
          ),
          radial-gradient(rgba(0, 0, 0, 0.1) 1px, transparent 1px);
        background-size: 18px 18px, 22px 22px;
        background-position: 0 0, 9px 11px;
        opacity: 0.1;
        pointer-events: none;
      }

      .bigImg {
        position: absolute;
        inset: 14px 14px 72px 14px;
        border-radius: 22px;
        overflow: hidden;
        border: 2px solid rgba(255, 255, 255, 0.22);
        background: rgba(255, 255, 255, 0.12);
        display: flex;
        align-items: center;
        justify-content: center;
      }
      .bigImg img {
        width: 100%;
        height: 100%;
        object-fit: contain;
        transform: none;
        background: transparent;
        filter: drop-shadow(0 16px 26px rgba(0, 0, 0, 0.22));
      }

      .bigFooter {
        position: absolute;
        left: 14px;
        right: 14px;
        bottom: 14px;
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 10px;
      }
      .bigPill {
        background: rgba(255, 255, 255, 0.65);
        border: 2px solid rgba(30, 36, 46, 0.28);
        color: rgba(30, 36, 46, 0.88);
        padding: 10px 14px;
        border-radius: 999px;
        font-weight: 900;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
      }
      .bigIntro {
        flex: 1;
        font-weight: 800;
      }

      .babySpot {
        position: absolute;
        right: 22px;
        top: 86px;
        width: min(260px, 36vw);
        height: min(220px, 26vh);
        z-index: 6;
        pointer-events: auto;
      }
      .babyCard {
        display: none;
        border-color: rgba(255, 180, 210, 0.55);
        box-shadow: 0 22px 50px rgba(255, 140, 180, 0.22),
          0 18px 30px rgba(0, 0, 0, 0.26);
      }
      .babyCard.show {
        display: block;
      }
      .babyInner {
        border-color: rgba(255, 200, 225, 0.5);
        background: linear-gradient(
          135deg,
          rgba(255, 210, 230, 0.18),
          rgba(255, 255, 255, 0.06)
        );
      }
      .babyLetter {
        background: rgba(255, 230, 240, 0.78);
        border-color: rgba(255, 160, 200, 0.38);
      }
      .babySticker {
        position: absolute;
        right: 10px;
        top: 10px;
        width: 40px;
        height: 40px;
        border-radius: 999px;
        display: flex;
        align-items: center;
        justify-content: center;
        background: rgba(255, 255, 255, 0.75);
        border: 2px solid rgba(255, 160, 200, 0.45);
        color: rgba(220, 60, 120, 0.95);
        font-weight: 900;
        transform: rotate(8deg);
        z-index: 3;
        user-select: none;
      }
      .babySpark {
        position: absolute;
        inset: -8px;
        pointer-events: none;
        opacity: 0;
      }
      .babySpark.on {
        animation: babySpark 900ms ease-out forwards;
      }
      @keyframes babySpark {
        0% {
          opacity: 0;
        }
        20% {
          opacity: 1;
        }
        100% {
          opacity: 0;
        }
      }
      .babySpark::before {
        content: "";
        position: absolute;
        inset: 0;
        background: radial-gradient(
              circle,
              rgba(255, 255, 255, 0.95) 0 2px,
              transparent 3px
            )
            10% 20%/26px 26px,
          radial-gradient(
              circle,
              rgba(255, 220, 240, 0.95) 0 2px,
              transparent 3px
            )
            80% 30%/30px 30px,
          radial-gradient(
              circle,
              rgba(255, 240, 190, 0.95) 0 2px,
              transparent 3px
            )
            20% 85%/28px 28px,
          radial-gradient(
              circle,
              rgba(210, 250, 255, 0.95) 0 2px,
              transparent 3px
            )
            90% 80%/32px 32px;
        filter: drop-shadow(0 8px 14px rgba(0, 0, 0, 0.25));
      }
      .babyTape {
        background: rgba(255, 230, 245, 0.32) !important;
        border-color: rgba(255, 170, 210, 0.22) !important;
      }

      .win {
        position: fixed;
        inset: 0;
        display: none;
        align-items: center;
        justify-content: center;
        z-index: 1000;
        background: rgba(0, 0, 0, 0.35);
        backdrop-filter: blur(6px);
        -webkit-backdrop-filter: blur(6px);
        opacity: 0;
        transition: opacity 380ms ease;
      }
      .win.show {
        display: flex;
        opacity: 1;
      }

      .winCard {
        width: min(92vw, 720px);
        border-radius: 28px;
        background: linear-gradient(
          135deg,
          rgba(255, 250, 240, 0.2),
          rgba(255, 250, 240, 0.12)
        );
        border: 2px solid rgba(255, 255, 255, 0.2);
        box-shadow: 0 30px 90px rgba(0, 0, 0, 0.45);
        padding: 22px 20px;
        position: relative;
        overflow: hidden;
        text-align: center;
        color: rgba(255, 255, 255, 0.95);
      }
      .winTitle {
        font-size: 34px;
        font-weight: 900;
        letter-spacing: 0.5px;
        margin: 8px 0 6px;
        text-shadow: 0 18px 40px rgba(0, 0, 0, 0.35);
      }
      .winSub {
        font-size: 16px;
        opacity: 0.92;
        font-weight: 800;
        margin: 0 0 14px;
      }
      .winHint {
        font-size: 14px;
        opacity: 0.85;
        margin-top: 10px;
      }
      .winBtn {
        margin-top: 14px;
        display: inline-flex;
        gap: 10px;
        align-items: center;
        justify-content: center;
        border: none;
        padding: 12px 16px;
        border-radius: 999px;
        background: rgba(255, 255, 255, 0.18);
        color: rgba(255, 255, 255, 0.96);
        font-weight: 900;
        cursor: pointer;
      }
      .winBtn:active {
        transform: scale(0.98);
      }

      .confetti {
        position: absolute;
        inset: -10px;
        pointer-events: none;
        overflow: hidden;
      }
      .confetti i {
        position: absolute;
        font-size: 18px;
        opacity: 0;
        animation: floatDown 1600ms ease-out forwards;
        filter: drop-shadow(0 10px 18px rgba(0, 0, 0, 0.25));
      }
      @keyframes floatDown {
        0% {
          transform: translateY(-40px) scale(0.6) rotate(0deg);
          opacity: 0;
        }
        20% {
          opacity: 1;
        }
        100% {
          transform: translateY(520px) scale(1.1) rotate(360deg);
          opacity: 0;
        }
      }

      body.night .bg {
        background: radial-gradient(
            circle at 30% 20%,
            rgba(255, 220, 235, 0.45),
            transparent 48%
          ),
          radial-gradient(
            circle at 70% 30%,
            rgba(255, 200, 225, 0.4),
            transparent 50%
          ),
          linear-gradient(180deg, #ffe8f1 0%, #ffdbe9 50%, #fbcfe0 100%);
      }
      body.night .page {
        background: linear-gradient(
          135deg,
          rgba(255, 250, 240, 0.12),
          rgba(255, 250, 240, 0.06)
        );
        border-color: rgba(255, 255, 255, 0.1);
      }
      body.night .pill,
      body.night .progressWrap {
        background: rgba(255, 255, 255, 0.08);
        border-color: rgba(255, 255, 255, 0.12);
      }
      body.night .badge {
        background: rgba(255, 255, 255, 0.08);
        border-color: rgba(255, 255, 255, 0.12);
      }

      .idleLayer {
        position: fixed;
        inset: 0;
        pointer-events: none;
        z-index: 12;
        opacity: 0;
        transition: opacity 600ms ease;
      }
      .idleLayer.show {
        opacity: 1;
      }
      .idleLayer i {
        position: absolute;
        font-size: 18px;
        opacity: 0;
        animation: idleFloat 5400ms linear infinite;
        filter: drop-shadow(0 10px 18px rgba(0, 0, 0, 0.25));
      }

      .brandTitle {
        pointer-events: none;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 10px;
        padding: 10px 14px;
        border-radius: 999px;
        background: rgba(255, 220, 235, 0.55);
        border: 1px solid rgba(255, 180, 210, 0.35);
        box-shadow: 0 8px 24px rgba(0, 0, 0, 0.22);
        color: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(8px);
        -webkit-backdrop-filter: blur(8px);
        white-space: nowrap;
        user-select: none;
      }
      .brandBadge {
        width: 34px;
        height: 34px;
        border-radius: 999px;
        display: flex;
        align-items: center;
        justify-content: center;
        background: rgba(255, 255, 255, 0.65);
        border: 2px solid rgba(30, 36, 46, 0.18);
        box-shadow: 0 10px 18px rgba(0, 0, 0, 0.18);
        font-size: 18px;
      }
      .brandText {
        font-weight: 950;
        letter-spacing: 1px;
        font-size: 18px;
        color: #7a2e4d;
        text-shadow: 0 2px 0 rgba(0, 0, 0, 0.18),
          0 10px 24px rgba(0, 0, 0, 0.28);
      }
      .brandSpark {
        font-size: 16px;
        opacity: 0.95;
        animation: brandTwinkle 1400ms ease-in-out infinite;
      }
      @keyframes brandTwinkle {
        0%,
        100% {
          transform: translateY(0) scale(1);
          opacity: 0.9;
        }
        50% {
          transform: translateY(-2px) scale(1.12);
          opacity: 1;
        }
      }

      @keyframes idleFloat {
        0% {
          transform: translateY(40vh) translateX(0) rotate(0deg);
          opacity: 0;
        }
        10% {
          opacity: 0.45;
        }
        50% {
          opacity: 0.22;
        }
        100% {
          transform: translateY(-35vh) translateX(18px) rotate(240deg);
          opacity: 0;
        }
      }

      /* é£˜æ¨±èŠ±/å°èŠ±èƒŒæ™¯å±‚ */
      .petals {
        position: fixed;
        inset: 0;
        pointer-events: none;
        z-index: 2;
        overflow: hidden;
      }
      .petal {
        position: absolute;
        top: -12vh;
        opacity: 0;
        animation-name: petalFall, petalSway;
        animation-timing-function: linear, ease-in-out;
        animation-iteration-count: infinite, infinite;
        filter: drop-shadow(0 8px 14px rgba(0, 0, 0, 0.12));
        will-change: transform, opacity, margin-left;
      }
      @keyframes petalFall {
        0% {
          transform: translateY(-12vh) rotate(0deg) scale(0.85);
          opacity: 0;
        }
        12% {
          opacity: 0.55;
        }
        100% {
          transform: translateY(112vh) rotate(280deg) scale(1.08);
          opacity: 0;
        }
      }
      @keyframes petalSway {
        0%,
        100% {
          margin-left: 0px;
        }
        50% {
          margin-left: var(--sway, 28px);
        }
      }
      .bg {
        z-index: 1;
      }
      .page {
        z-index: 5;
      }
      body.night .petal {
        opacity: 0.35;
      }
    </style>
  </head>

  <body>
    <div class="bg"></div>
    <div class="petals" id="petals" aria-hidden="true"></div>

    <div class="page">
      <div class="cornerTag">å¤§æŸšå­ç»˜æœ¬é¡µ-çˆ¸çˆ¸çš„å°å®è´</div>

      <div class="grid" id="grid">
        <script>
          document.write(
            Array.from({ length: 26 }, (_, i) => {
              const L = String.fromCharCode(65 + i);
              return `
            <div class="slot">
              <div class="card" id="card-${L}" data-letter="${L}">
                <div class="cardInner">
                  <img class="photo" id="img-${L}" alt="${L}">
                  <div class="missingMsg" id="msg-${L}"></div>
                </div>
                <div class="letterTag">${L}</div>
                <div class="nameTag" id="name-${L}">${L}</div>
                <div class="tape"></div>
                <div class="tape r"></div>
              </div>
            </div>
          `;
            }).join("")
          );
        </script>
      </div>

      <div class="babySpot" id="babySpot">
        <div class="card babyCard" id="card-BABY" data-letter="BABY">
          <div class="cardInner babyInner">
            <img class="photo" id="img-BABY" alt="BABY" />
            <div class="missingMsg" id="msg-BABY"></div>
            <div class="babySticker">â¤</div>
            <div class="babySpark" id="babySpark"></div>
          </div>
          <div class="letterTag babyLetter">â£</div>
          <div class="nameTag" id="name-BABY">å¤§æŸšå­</div>
          <div class="tape babyTape"></div>
          <div class="tape r babyTape"></div>
        </div>
      </div>
    </div>

    <div class="hud">
      <div class="pill">
        <button id="resetBtn" type="button" title="æ¸…å± (Esc)">æ¸…å±</button>
        <button id="soundBtn" type="button">æ‹Ÿå£°ï¼šå¼€</button>
        <button id="voiceBtn" type="button">ä»‹ç»ï¼šå¼€</button>
        <button id="nightBtn" type="button">å¤œé—´ï¼šè‡ªåŠ¨</button>
      </div>

      <div class="brandTitle" aria-hidden="true">
        <span class="brandBadge">ğŸª½</span>
        <span class="brandText">ç¾½å¸Œè¯†å›¾</span>
        <span class="brandSpark">âœ¨</span>
      </div>

      <div class="progressWrap" title="å·²æ”¶é›†çš„å¡ç‰‡æ•°é‡ï¼ˆA-Z + å®å®ï¼‰">
        <div class="bar"><i id="barFill"></i></div>
        <div class="count" id="countText">0/27</div>
      </div>

      <div class="pill">
        <label>éŸ³é‡</label>
        <input id="vol" type="range" min="0" max="100" value="55" />
      </div>
    </div>

    <div id="hint" class="hint">
      ğŸ‘¶ ç‚¹ä¸€ä¸‹é¡µé¢è·å¾—ç„¦ç‚¹<br />
      æŒ‰ Aï½Zï¼šå…ˆå¤§å¼¹çª—å±•ç¤º+è¯»ä»‹ç»ï¼›4 ç§’ä¸æ“ä½œè‡ªåŠ¨æ·¡å‡ºï¼›å¢™ä¸Šä¼šä¿ç•™<br />
      æŒ‰ ç©ºæ ¼ï¼šå®å®ä¸“å±å¡ï¼ˆè´´å¢™+å¼¹çª—ï¼‰âœ¨
      <small
        >ç‚¹å¡ç‰‡ï¼šä¸´æ—¶æ”¾å¤§ 1.2x å†è¯»ï¼›27/27 ä¼šæœ‰å¥–åŠ±ï¼›å®Œæˆå 10
        ç§’ä¸åŠ¨ä¼šè¿›å…¥å¾…æœº</small
      >
    </div>

    <div id="badge" class="badge">A - å°ç‹—</div>

    <div class="idleLayer" id="idleLayer" aria-hidden="true"></div>

    <div class="overlay" id="overlay" aria-hidden="true">
      <div class="bigBook">
        <div class="bigImg"><img id="overlayImg" alt="" /></div>
        <div class="bigFooter">
          <div class="bigPill" id="overlayTitle">A - å°ç‹—</div>
          <div class="bigPill bigIntro" id="overlayIntro">
            æˆ‘æ˜¯äººç±»çš„æœ‹å‹ï¼Œæˆ‘æ˜¯ç‹—ç‹—ï¼
          </div>
        </div>
      </div>
    </div>

    <div class="win" id="win" aria-hidden="true">
      <div class="winCard">
        <div class="confetti" id="confetti"></div>
        <div class="winTitle">ğŸ‰ å…¨æ”¶é›†å®Œæˆï¼</div>
        <div class="winSub">ä½ å¤ªæ£’å•¦ï½ 27/27</div>
        <div class="winHint">ç‚¹ä¸€ä¸‹ç»§ç»­ç©ï¼Œæˆ–è€…æŒ‰ Esc æ¸…å±</div>
        <button class="winBtn" id="winBtn" type="button">ç»§ç»­ç©</button>
      </div>
    </div>

    <script>
      (() => {
        const grid = document.getElementById("grid");
        const hint = document.getElementById("hint");
        const badge = document.getElementById("badge");
        const barFill = document.getElementById("barFill");
        const countText = document.getElementById("countText");
        const volEl = document.getElementById("vol");

        const overlay = document.getElementById("overlay");
        const overlayImg = document.getElementById("overlayImg");
        const overlayTitle = document.getElementById("overlayTitle");
        const overlayIntro = document.getElementById("overlayIntro");

        const win = document.getElementById("win");
        const confetti = document.getElementById("confetti");
        const winBtn = document.getElementById("winBtn");

        const idleLayer = document.getElementById("idleLayer");
        const nightBtn = document.getElementById("nightBtn");

        let overlayTimer = null;
        let lastInputAt = 0;

        let idleTimer = null;
        let idleOn = false;
        let winShown = false;

        const Animals = {
          A: { name: "å°ç‹—", intro: "æˆ‘æ˜¯äººç±»çš„æœ‹å‹ï¼Œæˆ‘æ˜¯ç‹—ç‹—ï¼" },
          B: { name: "å°çŒ«", intro: "æˆ‘ä¼šæŠ“è€é¼ ï¼Œä¹Ÿçˆ±æ’’å¨‡ï¼Œæˆ‘æ˜¯å°çŒ«å’ªï¼" },
          C: { name: "å°å…”", intro: "æˆ‘è·‘å¾—å¿«ï¼Œè€³æœµé•¿é•¿ï¼Œæˆ‘æ˜¯å°å…”å­ï¼" },
          D: { name: "å°ç†Š", intro: "æˆ‘èƒ–ä¹ä¹å¾ˆæ¸©æŸ”ï¼Œæˆ‘æ˜¯å°ç†Šï¼" },
          E: { name: "å°ç‹ç‹¸", intro: "æˆ‘èªæ˜æœºçµï¼Œå°¾å·´å¤§å¤§ï¼Œæˆ‘æ˜¯å°ç‹ç‹¸ï¼" },
          F: { name: "å°ç†ŠçŒ«", intro: "æˆ‘çˆ±ç«¹å­ï¼Œåœ†æ»šæ»šï¼Œæˆ‘æ˜¯å°ç†ŠçŒ«ï¼" },
          G: { name: "å°é’è›™", intro: "æˆ‘ä¼šè·³è·³ï¼Œä¹Ÿä¼šæ¸¸æ³³ï¼Œæˆ‘æ˜¯å°é’è›™ï¼" },
          H: { name: "å°çŒª", intro: "æˆ‘çˆ±åƒä¹Ÿçˆ±ç¡ï¼Œæˆ‘æ˜¯å°çŒªçŒªï¼" },
          I: { name: "å°ç‹®å­", intro: "æˆ‘æ˜¯è‰åŸå°ç‹å­ï¼Œæˆ‘æ˜¯å°ç‹®å­ï¼" },
          J: { name: "å°è€è™", intro: "æˆ‘æœ‰æ¡çº¹ï¼Œå‹‡æ•¢åˆå¸…ï¼Œæˆ‘æ˜¯å°è€è™ï¼" },
          K: { name: "å°ç‰›", intro: "æˆ‘ä¼šæ…¢æ…¢èµ°ï¼Œä¹Ÿä¼šåƒè‰ï¼Œæˆ‘æ˜¯å°ç‰›ï¼" },
          L: { name: "é•¿é¢ˆé¹¿", intro: "æˆ‘è„–å­é•¿é•¿ï¼Œèƒ½åƒåˆ°é«˜é«˜çš„å¶å­ï¼" },
          M: { name: "å°çŒ´", intro: "æˆ‘ä¼šçˆ¬æ ‘çˆ±ç©è€ï¼Œæˆ‘æ˜¯å°çŒ´å­ï¼" },
          N: { name: "å°ä¼é¹…", intro: "æˆ‘ç©¿å°è¥¿è£…ï¼Œæ‘‡æ‘‡æ‘†æ‘†ï¼Œæˆ‘æ˜¯å°ä¼é¹…ï¼" },
          O: { name: "çŒ«å¤´é¹°", intro: "æˆ‘æ™šä¸Šæ›´ç²¾ç¥ï¼Œæˆ‘æ˜¯çŒ«å¤´é¹°ï¼" },
          P: { name: "å°é¸­å­", intro: "æˆ‘ä¼šæ¸¸æ³³å˜å˜å«ï¼Œæˆ‘æ˜¯å°é¸­å­ï¼" },
          Q: { name: "å°åˆºçŒ¬", intro: "æˆ‘æœ‰å°åˆºåˆºï¼Œä½†æˆ‘å¾ˆå¯çˆ±ï¼Œæˆ‘æ˜¯å°åˆºçŒ¬ï¼" },
          R: { name: "å°æ²³é©¬", intro: "æˆ‘åœ¨æ°´é‡Œæ³¡æ¾¡æœ€å¼€å¿ƒï¼Œæˆ‘æ˜¯å°æ²³é©¬ï¼" },
          S: { name: "å°æµ·è±¹", intro: "æˆ‘ä¼šé¡¶çƒï¼Œä¹Ÿçˆ±é¼“æŒï¼Œæˆ‘æ˜¯å°æµ·è±¹ï¼" },
          T: { name: "å°è±¡", intro: "æˆ‘é¼»å­é•¿é•¿ä¼šå–·æ°´ï¼Œæˆ‘æ˜¯å°è±¡ï¼" },
          U: { name: "ç‹¬è§’å…½", intro: "æˆ‘æœ‰å°è§’è§’ï¼Œåƒç«¥è¯ä¸€æ ·ï¼Œæˆ‘æ˜¯ç‹¬è§’å…½ï¼" },
          V: { name: "å°é²¸é±¼", intro: "æˆ‘åœ¨æµ·é‡Œå”±æ­Œï¼Œæˆ‘æ˜¯å°é²¸é±¼ï¼" },
          W: { name: "å°ä¹Œé¾Ÿ", intro: "æˆ‘èµ°å¾—æ…¢ï¼Œä½†å¾ˆåŠªåŠ›ï¼Œæˆ‘æ˜¯å°ä¹Œé¾Ÿï¼" },
          X: { name: "æ–‘é©¬", intro: "æˆ‘æœ‰é»‘ç™½æ¡çº¹ï¼Œæˆ‘æ˜¯æ–‘é©¬ï¼" },
          Y: { name: "å°é±¼", intro: "æˆ‘åœ¨æ°´é‡Œåæ³¡æ³¡ï¼Œæˆ‘æ˜¯å°é±¼ï¼" },
          Z: { name: "å°æé¾™", intro: "æˆ‘æ˜¯è¿œå¤å°ä¼™ä¼´ï¼Œæˆ‘æ˜¯å°æé¾™ï¼" },
        };

        const Baby = {
          name: "å¤§æŸšå­",
          intro: "æˆ‘æ˜¯æ­¦ç¾½å¸Œï¼Œå¤§æŸšå­ï¼æˆ‘æ˜¯çˆ¸çˆ¸å¦ˆå¦ˆçš„å°å®è´ï½æˆ‘èªæ˜ä¼¶ä¿ï¼",
          img: "images/BABY.jpg",
        };

        const STORE_KEY = "storybook_ultimate_v2";
        const state = {
          cards: {},
          baby: false,
          soundOn: true,
          voiceOn: true,
          nightMode: 0,
        };

        function updateProgress() {
          const letters = Object.keys(state.cards).length;
          const baby = state.baby ? 1 : 0;
          const total = 27;
          const done = letters + baby;

          countText.textContent = `${done}/${total}`;
          barFill.style.width = `${Math.round((done / total) * 100)}%`;

          if (done > 0) hint.classList.add("hidden");
          else hint.classList.remove("hidden");

          if (done === total) showWin();
        }

        function save() {
          try {
            localStorage.setItem(STORE_KEY, JSON.stringify(state));
          } catch (e) {}
        }
        function load() {
          try {
            const raw = localStorage.getItem(STORE_KEY);
            if (!raw) return;
            const data = JSON.parse(raw);
            if (!data || typeof data !== "object") return;
            state.cards = data.cards || {};
            state.baby = !!data.baby;
            state.soundOn = data.soundOn !== false;
            state.voiceOn = data.voiceOn !== false;
            state.nightMode =
              typeof data.nightMode === "number" ? data.nightMode : 0;
          } catch (e) {}
        }
        function clearAll() {
          state.cards = {};
          state.baby = false;
          winShown = false;
          try {
            localStorage.removeItem(STORE_KEY);
          } catch (e) {}
        }

        // === æ‹Ÿå£°ï¼ˆä¿ç•™ä½ åŸæœ¬çš„ï¼‰===
        let audioCtx = null;
        function ensureAudio() {
          if (!audioCtx)
            audioCtx = new (window.AudioContext || window.webkitAudioContext)();
          if (audioCtx.state === "suspended") audioCtx.resume();
        }
        function gainVal() {
          return (Number(volEl.value) / 100) * 0.12;
        }
        function playSfx(letter) {
          if (!state.soundOn) return;
          ensureAudio();
          const t0 = audioCtx.currentTime;
          const g = audioCtx.createGain();
          g.gain.setValueAtTime(0.0001, t0);
          g.gain.exponentialRampToValueAtTime(
            Math.max(0.0001, gainVal()),
            t0 + 0.01
          );
          g.gain.exponentialRampToValueAtTime(0.0001, t0 + 0.28);
          g.connect(audioCtx.destination);

          const o = audioCtx.createOscillator();
          o.type = "sine";
          const idx = (letter.charCodeAt(0) - 65 + 26) % 26;
          const base = 260 + idx * 8;
          o.frequency.setValueAtTime(base + 240, t0);
          o.frequency.exponentialRampToValueAtTime(base + 140, t0 + 0.12);
          o.frequency.exponentialRampToValueAtTime(base + 200, t0 + 0.26);
          o.connect(g);
          o.start(t0);
          o.stop(t0 + 0.3);
        }

        function playWinMelody() {
          ensureAudio();
          const t0 = audioCtx.currentTime;

          const notes = [523.25, 659.25, 783.99, 659.25, 523.25];
          const dur = 0.16;

          const master = audioCtx.createGain();
          master.gain.setValueAtTime(0.0001, t0);
          master.gain.exponentialRampToValueAtTime(
            Math.max(0.0001, (Number(volEl.value) / 100) * 0.06),
            t0 + 0.02
          );
          master.gain.exponentialRampToValueAtTime(
            0.0001,
            t0 + notes.length * dur + 0.12
          );
          master.connect(audioCtx.destination);

          notes.forEach((f, i) => {
            const o = audioCtx.createOscillator();
            const g = audioCtx.createGain();
            o.type = "sine";
            o.frequency.setValueAtTime(f, t0 + i * dur);

            g.gain.setValueAtTime(0.0001, t0 + i * dur);
            g.gain.exponentialRampToValueAtTime(0.35, t0 + i * dur + 0.02);
            g.gain.exponentialRampToValueAtTime(0.0001, t0 + (i + 1) * dur);

            o.connect(g);
            g.connect(master);

            o.start(t0 + i * dur);
            o.stop(t0 + (i + 1) * dur + 0.02);
          });
        }

        // ==========================================================
        // âœ… è¯­éŸ³ï¼šæ›´æŸ”å’Œã€æ›´åƒè®²ç»˜æœ¬ï¼ˆæ›¿æ¢åŸ speak / speakSweetï¼‰
        // ==========================================================
        let voiceReady = false;

        function normalizeKidText(text) {
          // è®©åœé¡¿æ›´è‡ªç„¶ï¼šæŠŠæ ‡ç‚¹æ›¿æ¢æˆè½»åœé¡¿ï¼ˆä¸ä¼šå¤ªæœºæ¢°ï¼‰
          return String(text || "")
            .replace(/\s+/g, " ")
            .replace(/ï¼Œ/g, "ï¼Œ ")
            .replace(/ã€‚/g, "ã€‚ ")
            .replace(/ï¼/g, "ï¼ ")
            .replace(/ï¼Ÿ/g, "ï¼Ÿ ");
        }

        function getNiceZhVoice() {
          const vs = speechSynthesis.getVoices() || [];
          if (!vs.length) return null;

          // ä¼˜å…ˆï¼šä¸­æ–‡ + å¥³å£°å€¾å‘ï¼ˆåå­—é‡Œå¸¸è§å…³é”®å­—ï¼‰
          const prefer = [
            (v) => v.lang.startsWith("zh") && /female|woman|girl|å¥³/i.test(v.name),
            (v) => v.lang.startsWith("zh") && /xiaoxiao|xiaoyi|huihui|tingting/i.test(v.name),
            (v) => v.lang.startsWith("zh"),
          ];

          for (const rule of prefer) {
            const found = vs.find(rule);
            if (found) return found;
          }
          return vs[0] || null;
        }

        function speakKid(text, mode = "normal") {
          if (!state.voiceOn) return;
          try {
            // iOS/éƒ¨åˆ†æµè§ˆå™¨ï¼šå…ˆè§¦å‘ä¸€æ¬¡ voices è½½å…¥
            if (!voiceReady) {
              speechSynthesis.getVoices();
              voiceReady = true;
            }

            speechSynthesis.cancel();

            const u = new SpeechSynthesisUtterance(normalizeKidText(text));
            u.lang = "zh-CN";

            // ä¸¤æ¡£ï¼šæ™®é€šè®²è§£ / æ›´è½¯çš„å¥–åŠ±
            if (mode === "soft") {
              u.rate = 0.72;   // æ›´æ…¢æ›´æŸ”
              u.pitch = 1.42;  // æ›´ç«¥å£°
            } else {
              u.rate = 0.80;
              u.pitch = 1.30;
            }

            // ç¨å¾®ä¸€ç‚¹ç‚¹éšæœºï¼Œè®©ä¸é‚£ä¹ˆâ€œæœºå™¨é‡å¤â€
            u.rate = Math.max(0.65, Math.min(1.0, u.rate + (Math.random() - 0.5) * 0.04));
            u.pitch = Math.max(0.9, Math.min(1.8, u.pitch + (Math.random() - 0.5) * 0.06));

            u.volume = Math.min(1, Math.max(0, Number(volEl.value) / 100));

            const v = getNiceZhVoice();
            if (v) u.voice = v;

            speechSynthesis.speak(u);
          } catch (e) {}
        }

        // å…¼å®¹ä½ åŸæ¥è°ƒç”¨ï¼šspeak / speakSweet
        function speak(text) {
          speakKid(text, "normal");
        }
        function speakSweet(text) {
          speakKid(text, "soft");
        }

        // voices changed äº‹ä»¶ï¼šé¿å…ç¬¬ä¸€æ¬¡æ²¡å£°éŸ³/é€‰ä¸åˆ°å¥³å£°
        if (typeof speechSynthesis !== "undefined") {
          speechSynthesis.onvoiceschanged = () => {
            voiceReady = true;
          };
        }

        // === å¤œé—´æ¨¡å¼ ===
        function applyNightMode() {
          const nightMode = state.nightMode ?? 0;
          let on = false;
          if (nightMode === 1) on = true;
          else if (nightMode === 2) on = false;
          else {
            const h = new Date().getHours();
            on = h >= 20 || h < 7;
          }
          document.body.classList.toggle("night", on);
          if (nightBtn) {
            nightBtn.textContent =
              nightMode === 0
                ? "å¤œé—´ï¼šè‡ªåŠ¨"
                : nightMode === 1
                ? "å¤œé—´ï¼šå¼€"
                : "å¤œé—´ï¼šå…³";
          }
        }

        // Overlay auto hide
        function scheduleOverlayAutoHide() {
          clearTimeout(overlayTimer);
          overlayTimer = setTimeout(() => {
            if (Date.now() - lastInputAt < 4900) {
              scheduleOverlayAutoHide();
              return;
            }
            overlay.classList.add("fade");
            setTimeout(() => {
              overlay.classList.remove("show", "fade");
              overlay.setAttribute("aria-hidden", "true");
            }, 480);
          }, 5000);
        }

        function showOverlayPicture(title, intro, imgUrl, alt) {
          overlayTitle.textContent = title;
          overlayIntro.textContent = intro;
          overlayImg.src =
            imgUrl + (imgUrl.includes("?") ? "&" : "?") + "v=" + Date.now();
          overlayImg.alt = alt || title;

          overlay.classList.remove("fade");
          overlay.classList.add("show");
          overlay.setAttribute("aria-hidden", "false");
          scheduleOverlayAutoHide();
        }

        function showOverlayLetter(letter) {
          const info = Animals[letter];
          if (!info) return;
          showOverlayPicture(
            `${letter} - ${info.name}`,
            info.intro,
            `images/${letter}1.jpg`,
            `${letter} ${info.name}`
          );
        }

        overlay.addEventListener("click", () => {
          lastInputAt = Date.now();
          stopIdle();
          overlay.classList.add("fade");
          setTimeout(() => {
            overlay.classList.remove("show", "fade");
            overlay.setAttribute("aria-hidden", "true");
          }, 480);
        });

        // idle
        function stopIdle() {
          if (!idleLayer) return;
          idleOn = false;
          idleLayer.classList.remove("show");
          idleLayer.setAttribute("aria-hidden", "true");
          idleLayer.innerHTML = "";
        }

        function startIdle() {
          if (!idleLayer || idleOn) return;
          idleOn = true;
          idleLayer.innerHTML = "";
          const icons = ["â­", "âœ¨", "ğŸ’›", "ğŸ’–"];
          for (let i = 0; i < 14; i++) {
            const s = document.createElement("i");
            s.textContent = icons[Math.floor(Math.random() * icons.length)];
            s.style.left = Math.random() * 100 + "%";
            s.style.top = 60 + Math.random() * 40 + "%";
            s.style.fontSize = 14 + Math.random() * 14 + "px";
            s.style.animationDelay = Math.random() * 2600 + "ms";
            s.style.animationDuration = 4600 + Math.random() * 2600 + "ms";
            idleLayer.appendChild(s);
          }
          idleLayer.classList.add("show");
          idleLayer.setAttribute("aria-hidden", "false");
        }

        function scheduleIdleCheck() {
          clearTimeout(idleTimer);
          idleTimer = setTimeout(() => {
            const letters = Object.keys(state.cards).length;
            const baby = state.baby ? 1 : 0;
            const done = letters + baby;
            const total = 27;

            if (done === total && Date.now() - lastInputAt >= 10000)
              startIdle();
            else stopIdle();

            scheduleIdleCheck();
          }, 1200);
        }

        // win
        function fireConfetti() {
          if (!confetti) return;
          confetti.innerHTML = "";
          const icons = ["â­", "âœ¨", "ğŸ’–", "ğŸ’›"];
          for (let i = 0; i < 22; i++) {
            const p = document.createElement("i");
            const x = Math.random() * 100;
            const delay = Math.random() * 300;
            const icon = icons[Math.floor(Math.random() * icons.length)];
            const size = 14 + Math.random() * 14;

            p.textContent = icon;
            p.style.left = x + "%";
            p.style.top = -20 - Math.random() * 60 + "px";
            p.style.fontSize = size + "px";
            p.style.animationDelay = delay + "ms";
            confetti.appendChild(p);
          }
        }

        function showWin() {
          if (winShown) return;
          winShown = true;

          fireConfetti();
          win.classList.add("show");
          win.setAttribute("aria-hidden", "false");

          playWinMelody();
          speakSweet("å¤ªæ£’å•¦ï½ä½ å…¨éƒ¨éƒ½æ”¶é›†åˆ°äº†ï¼ä½ çœŸæ£’ï¼çˆ¸çˆ¸å¦ˆå¦ˆçˆ±ä½ ï½");

          setTimeout(hideWin, 3200);
        }

        function hideWin() {
          if (!win) return;
          win.classList.remove("show");
          win.setAttribute("aria-hidden", "true");
        }

        winBtn?.addEventListener("click", () => {
          lastInputAt = Date.now();
          stopIdle();
          hideWin();
        });
        win?.addEventListener("click", () => {
          lastInputAt = Date.now();
          stopIdle();
          hideWin();
        });

        // setCard
        function setCard(letter, isNew = false) {
          const info = Animals[letter];
          if (!info) return;

          const card = document.getElementById(`card-${letter}`);
          const img = document.getElementById(`img-${letter}`);
          const msg = document.getElementById(`msg-${letter}`);
          const name = document.getElementById(`name-${letter}`);
          if (!card || !img || !msg || !name) return;

          card.classList.add("show");
          name.textContent = info.name;

          if (isNew) {
            card.classList.remove("pop");
            void card.offsetWidth;
            card.classList.add("pop");
            setTimeout(() => card.classList.remove("pop"), 650);
          }

          document
            .querySelectorAll(".card.active")
            .forEach((el) => el.classList.remove("active"));
          card.classList.add("active");
          grid.classList.add("dim");

          card.onclick = () => {
            lastInputAt = Date.now();
            stopIdle();

            card.classList.add("zoom");
            setTimeout(() => card.classList.remove("zoom"), 320);

            playSfx(letter);
            speak(info.intro);

            showOverlayLetter(letter);

            document
              .querySelectorAll(".card.active")
              .forEach((el) => el.classList.remove("active"));
            card.classList.add("active");
            grid.classList.add("dim");
          };

          msg.classList.remove("show");
          img.style.display = "";
          const url = `images/${letter}1.jpg?v=${Date.now()}`;
          img.onload = () => {
            msg.classList.remove("show");
            img.style.display = "";
          };
          img.onerror = () => {
            img.style.display = "none";
            msg.textContent = `æ‰¾ä¸åˆ°å›¾ç‰‡ï¼šimages/${letter}1.jpg\nè¯·ç¡®è®¤ images æ–‡ä»¶å¤¹ä¸ YoYo.html åŒçº§\nä¸”æ–‡ä»¶åæ˜¯ ${letter}1.jpgï¼ˆå¤§å†™ï¼‰`;
            msg.classList.add("show");
          };
          img.src = url;
        }

        // baby
        function setBabyCard(isNew = false) {
          const card = document.getElementById("card-BABY");
          const img = document.getElementById("img-BABY");
          const msg = document.getElementById("msg-BABY");
          const name = document.getElementById("name-BABY");
          const spark = document.getElementById("babySpark");
          if (!card || !img || !msg || !name) return;

          card.classList.add("show");
          name.textContent = Baby.name;

          if (isNew && spark) {
            spark.classList.remove("on");
            void spark.offsetWidth;
            spark.classList.add("on");
            setTimeout(() => spark.classList.remove("on"), 950);
          }

          card.onclick = () => {
            lastInputAt = Date.now();
            stopIdle();

            card.classList.add("zoom");
            setTimeout(() => card.classList.remove("zoom"), 320);

            showOverlayPicture(`â¤ ${Baby.name}`, Baby.intro, Baby.img, Baby.name);
            playSfx("A");
            speak(Baby.intro);
          };

          msg.classList.remove("show");
          img.style.display = "";
          img.onload = () => {
            msg.classList.remove("show");
            img.style.display = "";
          };
          img.onerror = () => {
            img.style.display = "none";
            msg.textContent = `æ‰¾ä¸åˆ°å®å®ç…§ç‰‡ï¼š${Baby.img}\nè¯·æ”¾å…¥ images/BABY.jpg`;
            msg.classList.add("show");
          };
          img.src = `${Baby.img}?v=${Date.now()}`;
        }

        function spawnOrFlip(letter) {
          const info = Animals[letter];
          if (!info) return;

          lastInputAt = Date.now();
          stopIdle();

          const isNew = !state.cards[letter];
          if (isNew) state.cards[letter] = { shown: true };

          showOverlayLetter(letter);
          playSfx(letter);
          speak(info.intro);

          setCard(letter, isNew);

          badge.textContent = `${letter} - ${info.name}`;
          badge.classList.add("show");
          clearTimeout(badge._t);
          badge._t = setTimeout(() => badge.classList.remove("show"), 900);

          save();
          updateProgress();
        }

        function restore() {
          for (const letter in state.cards) {
            if (Animals[letter]) setCard(letter, false);
          }
          if (state.baby) setBabyCard(false);
          updateProgress();
        }

        // key
        let lastKeyAt = 0;
        window.addEventListener(
          "keydown",
          (e) => {
            lastInputAt = Date.now();
            stopIdle();

            if (e.code === "Space") {
              e.preventDefault();
              showOverlayPicture(`â¤ ${Baby.name}`, Baby.intro, Baby.img, Baby.name);
              playSfx("A");
              speak(Baby.intro);

              const isNew = !state.baby;
              state.baby = true;
              setBabyCard(isNew);

              save();
              updateProgress();
              return;
            }

            if (e.key === "Escape") {
              clearAll();
              for (let i = 0; i < 26; i++) {
                const L = String.fromCharCode(65 + i);
                document
                  .getElementById(`card-${L}`)
                  ?.classList.remove("show", "active", "pop", "zoom");
              }
              document
                .getElementById("card-BABY")
                ?.classList.remove("show", "active", "pop", "zoom");
              grid.classList.remove("dim");
              overlay.classList.remove("show", "fade");
              overlay.setAttribute("aria-hidden", "true");
              hideWin();
              stopIdle();
              try {
                speechSynthesis.cancel();
              } catch (_) {}
              updateProgress();
              return;
            }

            const now = performance.now();
            if (now - lastKeyAt < 90) return;
            lastKeyAt = now;

            const L = (e.key || "").toUpperCase();
            if (L.length === 1 && L >= "A" && L <= "Z") spawnOrFlip(L);
          },
          { passive: false }
        );

        window.addEventListener(
          "pointerdown",
          () => {
            lastInputAt = Date.now();
            stopIdle();
            window.focus();
          },
          { passive: true }
        );
        window.addEventListener(
          "touchstart",
          () => {
            lastInputAt = Date.now();
            stopIdle();
            window.focus();
          },
          { passive: true }
        );

        const soundBtn = document.getElementById("soundBtn");
        const voiceBtn = document.getElementById("voiceBtn");

        document.getElementById("resetBtn").addEventListener("click", () => {
          lastInputAt = Date.now();
          stopIdle();

          clearAll();
          for (let i = 0; i < 26; i++) {
            const L = String.fromCharCode(65 + i);
            document
              .getElementById(`card-${L}`)
              ?.classList.remove("show", "active", "pop", "zoom");
          }
          document
            .getElementById("card-BABY")
            ?.classList.remove("show", "active", "pop", "zoom");
          grid.classList.remove("dim");
          overlay.classList.remove("show", "fade");
          overlay.setAttribute("aria-hidden", "true");
          hideWin();
          try {
            speechSynthesis.cancel();
          } catch (_) {}
          updateProgress();
        });

        soundBtn.addEventListener("click", () => {
          lastInputAt = Date.now();
          stopIdle();

          state.soundOn = !state.soundOn;
          soundBtn.textContent = state.soundOn ? "æ‹Ÿå£°ï¼šå¼€" : "æ‹Ÿå£°ï¼šå…³";
          save();
        });

        voiceBtn.addEventListener("click", () => {
          lastInputAt = Date.now();
          stopIdle();

          state.voiceOn = !state.voiceOn;
          voiceBtn.textContent = state.voiceOn ? "ä»‹ç»ï¼šå¼€" : "ä»‹ç»ï¼šå…³";
          if (!state.voiceOn) {
            try {
              speechSynthesis.cancel();
            } catch (_) {}
          }
          save();
        });

        nightBtn?.addEventListener("click", () => {
          lastInputAt = Date.now();
          stopIdle();

          state.nightMode = (state.nightMode + 1) % 3;
          save();
          applyNightMode();
        });

        function initPetals() {
          const wrap = document.getElementById("petals");
          if (!wrap) return;
          wrap.innerHTML = "";

          const icons = ["ğŸŒ¸", "ğŸŒ¼", "ğŸ’®", "ğŸŒ·"];
          const count = 18;

          for (let i = 0; i < count; i++) {
            const p = document.createElement("div");
            p.className = "petal";
            p.textContent = icons[Math.floor(Math.random() * icons.length)];

            const x = Math.random() * 100;
            const size = 14 + Math.random() * 18;
            const fall = 12 + Math.random() * 10;
            const sway = 3.8 + Math.random() * 3.8;
            const delay = Math.random() * 8;

            p.style.left = x + "%";
            p.style.fontSize = size + "px";
            p.style.animationDuration = `${fall}s, ${sway}s`;
            p.style.animationDelay = `${delay}s, ${Math.random() * 2}s`;
            p.style.setProperty("--sway", 18 + Math.random() * 34 + "px");

            wrap.appendChild(p);
          }
        }

        // === å¯åŠ¨ ===
        load();
        soundBtn.textContent = state.soundOn ? "æ‹Ÿå£°ï¼šå¼€" : "æ‹Ÿå£°ï¼šå…³";
        voiceBtn.textContent = state.voiceOn ? "ä»‹ç»ï¼šå¼€" : "ä»‹ç»ï¼šå…³";
        applyNightMode();
        restore();
        scheduleIdleCheck();
        initPetals();

        // âœ… å…³é”®ï¼šå°½é‡æå‰â€œå”¤é†’â€voicesï¼ˆé¿å…ç¬¬ä¸€æ¬¡æœºæ¢°/æ— å£°ï¼‰
        try {
          speechSynthesis.getVoices();
        } catch (_) {}
      })();
    </script>
  </body>
</html>
