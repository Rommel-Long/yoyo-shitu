<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover,user-scalable=no" />
  <title>å®å®ç»˜æœ¬å¢™ï¼šA-Z ç…§ç‰‡ç‰ˆï¼ˆç¨³å®šï¼‰</title>
  <style>
    :root{
      --ink: rgba(30,36,46,.88);
      --paper: rgba(255,250,240,.16);
      --paper2: rgba(255,250,240,.10);
    }
    html,body{height:100%; margin:0; overflow:hidden; background:#081028; font-family: system-ui,-apple-system,"PingFang SC","Microsoft YaHei",sans-serif;}
    .bg{ position:fixed; inset:0; background: linear-gradient(135deg,#081028,#0b2a33); }
    .page{
      position:fixed; inset:14px;
      border-radius: 28px;
      background: linear-gradient(135deg,var(--paper),var(--paper2));
      border: 2px solid rgba(255,255,255,.14);
      box-shadow: 0 18px 40px rgba(0,0,0,.28);
      overflow:hidden;
    }
    .page::before{
      content:"";
      position:absolute; inset:0;
      background-image:
        radial-gradient(rgba(255,255,255,.10) 1px, transparent 1px),
        radial-gradient(rgba(0,0,0,.10) 1px, transparent 1px);
      background-size: 18px 18px, 22px 22px;
      background-position: 0 0, 9px 11px;
      opacity:.10;
      pointer-events:none;
    }
    .cornerTag{
      position:absolute; right:14px; bottom:14px;
      padding:10px 14px;
      border-radius: 999px;
      background: rgba(255,255,255,.18);
      border: 2px solid rgba(30,36,46,.18);
      color: rgba(30,36,46,.78);
      font-weight:700;
      user-select:none;
      pointer-events:none;
      z-index:5;
    }

    .hud{
      position:fixed; left:12px; right:12px; top:12px;
      display:flex; gap:10px; align-items:center; justify-content:space-between;
      z-index:20; pointer-events:none;
    }
    .pill, .progressWrap{
      pointer-events:auto;
      background:rgba(255,255,255,.10);
      border:1px solid rgba(255,255,255,.18);
      color:rgba(255,255,255,.92);
      padding:10px 12px;
      border-radius:999px;
      backdrop-filter: blur(8px);
      -webkit-backdrop-filter: blur(8px);
      display:flex; align-items:center; gap:10px;
      box-shadow: 0 8px 24px rgba(0,0,0,.25);
      user-select:none; -webkit-user-select:none;
    }
    .pill button{
      appearance:none; border:none;
      background:rgba(255,255,255,.14);
      color:rgba(255,255,255,.92);
      padding:10px 12px;
      border-radius:999px;
      font-size:14px; font-weight:700;
      cursor:pointer;
    }
    .pill button:active{ transform:scale(.98); }
    .pill label{ font-size:14px; opacity:.95; }
    .pill input[type="range"]{ width:120px; }

    .progressWrap{ min-width:220px; }
    .bar{ height:10px; flex:1; background:rgba(255,255,255,.12); border:1px solid rgba(255,255,255,.14); border-radius:999px; overflow:hidden; }
    .bar>i{ display:block; height:100%; width:0%; background:rgba(255,255,255,.55); border-radius:999px; transition:width .25s ease; }
    .count{ font-size:13px; opacity:.95; white-space:nowrap; }

    .hint{
      position:fixed; inset:0;
      display:flex; align-items:center; justify-content:center; flex-direction:column;
      color:rgba(255,255,255,.82);
      text-align:center;
      font-size:20px; line-height:1.4;
      padding:24px;
      text-shadow:0 10px 30px rgba(0,0,0,.35);
      transition:opacity .35s ease;
      pointer-events:none;
      z-index:15;
    }
    .hint.hidden{ opacity:0; }
    .hint small{ opacity:.8; font-size:14px; margin-top:10px; }

    .badge{
      position:fixed; left:50%; bottom:18px; transform:translateX(-50%);
      background:rgba(255,255,255,.10);
      border:1px solid rgba(255,255,255,.16);
      color:rgba(255,255,255,.9);
      padding:10px 14px;
      border-radius:999px;
      font-size:14px;
      backdrop-filter: blur(8px);
      -webkit-backdrop-filter: blur(8px);
      box-shadow: 0 8px 24px rgba(0,0,0,.25);
      opacity:0;
      transition: opacity .25s ease;
      pointer-events:none;
      max-width: 92vw;
      white-space: nowrap;
      overflow:hidden;
      text-overflow: ellipsis;
      z-index:20;
    }
    .badge.show{ opacity:1; }

    .grid{
      position:absolute;
      left:22px; right:22px; top:86px; bottom:66px;
      display:grid;
      grid-template-columns: repeat(6, minmax(0,1fr));
      grid-template-rows: repeat(5, minmax(0,1fr));
      gap: 16px;
      padding: 10px;
    }

    .slot{
      position:relative;
      border-radius: 22px;
      border:2px dashed rgba(30,36,46,.18);
      background: rgba(255,255,255,.02);
      overflow:visible;
    }

    .card{
      position:absolute; inset:0;
      border-radius: 22px;
      background: rgba(255,255,255,.10);
      border: 3px solid rgba(255,255,255,.22);
      box-shadow: 0 16px 26px rgba(0,0,0,.26);
      overflow:hidden;
      display:none;
      cursor:pointer;
    }
    .card.show{ display:block; }

    .cardInner{
      position:absolute; inset:10px;
      border-radius: 18px;
      border: 2px solid rgba(255,255,255,.22);
      overflow:hidden;
      background: rgba(255,255,255,.06);
      inset:6px;
    }

    .photo{
      position:absolute; inset:0;
      width:100%; height:100%;
      object-fit: cover;
      z-index:1;
      transform: scale(1.06);
    }

    .missingMsg{
      position:absolute; inset:0;
      z-index:2;
      display:none;
      align-items:center;
      justify-content:center;
      padding:14px;
      white-space:pre-wrap;
      text-align:left;
      font-weight:800;
      color: rgba(30,36,46,.78);
      background: linear-gradient(135deg, rgba(255,255,255,.16), rgba(255,255,255,.08));
    }
    .missingMsg.show{ display:flex; }

    .letterTag{
      position:absolute; left:10px; top:10px;
      padding:8px 10px;
      border-radius: 999px;
      background: rgba(255,255,255,.62);
      border: 2px solid rgba(30,36,46,.28);
      color: rgba(30,36,46,.86);
      font-weight:900;
      min-width: 44px;
      text-align:center;
      z-index:3;
    }

    .nameTag{
      position:absolute; left:14%; right:14%; bottom:10px;
      padding:8px 10px;
      border-radius: 999px;
      background: rgba(255,255,255,.62);
      border: 2px solid rgba(30,36,46,.28);
      color: rgba(30,36,46,.86);
      font-weight:800;
      text-align:center;
      font-size: 14px;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
      z-index:3;
    }

    .tape{
      position:absolute; top:-8px; left:10px;
      width:34%; height:16px;
      border-radius: 999px;
      background: rgba(255,255,255,.26);
      border: 2px solid rgba(30,36,46,.16);
      transform: rotate(-2deg);
      pointer-events:none;
      z-index:3;
    }
    .tape.r{
      left:auto; right:10px;
      transform: rotate(4deg);
      width:30%;
      background: rgba(255,255,255,.20);
    }

    /* === åŠ¨ç”»/é«˜äº® === */
.card{
  transform: scale(1);
  transition: transform 220ms ease, filter 220ms ease, opacity 220ms ease;
  will-change: transform, filter, opacity;
}

/* æ–°è´´å¡ï¼šè½»è½»æ”¾å¤§å¼¹ä¸€ä¸‹ */
.card.pop{
  animation: popIn 520ms cubic-bezier(.2, .9, .2, 1) both;
}
@keyframes popIn{
  0%   { transform: scale(.92); }
  55%  { transform: scale(1.06); }
  100% { transform: scale(1.00); }
}

/* å½“å‰é«˜äº®ï¼Œå…¶å®ƒå˜æš—ä¸€ç‚¹ */
.grid.dim .card.show{
  opacity: .55;
  filter: saturate(.95) brightness(.92);
}
.grid.dim .card.show.active{
  opacity: 1;
  filter: none;
  transform: scale(1.04);
  box-shadow: 0 20px 40px rgba(0,0,0,.35);
  border-color: rgba(255,255,255,.35);
}

/* ç‚¹å‡»å¡ç‰‡ï¼šä¸´æ—¶æ”¾å¤§ 1.2x */
.card.zoom{
  transform: scale(1.20) !important;
  z-index: 50;
}

/* è®©å±…ä¸­æ»šåŠ¨æ›´é¡ºæ»‘ */
.page { overflow: hidden; }
.grid{
  overflow:auto;
  scroll-behavior:smooth;
  -webkit-overflow-scrolling: touch;
  padding-bottom: 20px;
}


  </style>
</head>
<body>
  <div class="bg"></div>
  <div class="page">
    <div class="cornerTag">ç»˜æœ¬é¡µ</div>

    <div class="grid" id="grid">
      <!-- 26 ä¸ªæ§½ä½ï¼ˆå†™æ­» DOMï¼Œä¿è¯æ°¸è¿œæœ‰ imgï¼‰ -->
      <script>
        // è¿™é‡Œç”¨è„šæœ¬â€œå†™æ­»ç”Ÿæˆâ€é™æ€DOMï¼šç”Ÿæˆåå°±æ˜¯çº¯HTMLç»“æ„ï¼Œç¨³å®šä¸ä¸¢ img
        document.write(Array.from({length:26}, (_,i)=>{
          const L = String.fromCharCode(65+i);
          return `
            <div class="slot">
              <div class="card" id="card-${L}" data-letter="${L}">
                <div class="cardInner">
                  <img class="photo" id="img-${L}" alt="${L}">
                  <div class="missingMsg" id="msg-${L}"></div>
                </div>
                <div class="letterTag">${L}</div>
                <div class="nameTag" id="name-${L}">${L}</div>
                <div class="tape"></div>
                <div class="tape r"></div>
              </div>
            </div>
          `;
        }).join(''));
      </script>
    </div>
  </div>

  <div class="hud">
    <div class="pill">
      <button id="resetBtn" type="button" title="æ¸…å± (Esc)">æ¸…å±</button>
      <button id="soundBtn" type="button">æ‹Ÿå£°ï¼šå¼€</button>
      <button id="voiceBtn" type="button">ä»‹ç»ï¼šå¼€</button>
    </div>

    <div class="progressWrap">
      <div class="bar"><i id="barFill"></i></div>
      <div class="count" id="countText">0/26</div>
    </div>

    <div class="pill">
      <label>éŸ³é‡</label>
      <input id="vol" type="range" min="0" max="100" value="55" />
    </div>
  </div>

  <div id="hint" class="hint">
    ğŸ‘¶ ç‚¹ä¸€ä¸‹é¡µé¢è·å¾—ç„¦ç‚¹<br/>æŒ‰é”®ç›˜ Aï½Z è´´ç…§ç‰‡å¡ï¼›å†æŒ‰åŒå­—æ¯ä¼šâ€œç¿»é¡µâ€ï¼ˆä½ åªæœ‰ 1 å¼ å°±é‡å¤æ˜¾ç¤ºï¼‰
    <small>ä¹Ÿå¯ä»¥ç‚¹å¡ç‰‡å¬ä»‹ç»ï¼›Esc æ¸…å±ï¼›åˆ·æ–°ä¼šä¿ç•™</small>
  </div>

  <div id="badge" class="badge">A - å°ç‹—</div>

<script>
(() => {
  const hint = document.getElementById('hint');
  const badge = document.getElementById('badge');
  const barFill = document.getElementById('barFill');
  const countText = document.getElementById('countText');
  const volEl = document.getElementById('vol');
  const grid = document.getElementById('grid');

  const Animals = {
    A:{ name:'å°ç‹—', intro:'æˆ‘æ˜¯äººç±»çš„æœ‹å‹ï¼Œæˆ‘æ˜¯ç‹—ç‹—ï¼' },
    B:{ name:'å°çŒ«', intro:'æˆ‘ä¼šæŠ“è€é¼ ï¼Œä¹Ÿçˆ±æ’’å¨‡ï¼Œæˆ‘æ˜¯å°çŒ«å’ªï¼' },
    C:{ name:'å°å…”', intro:'æˆ‘è·‘å¾—å¿«ï¼Œè€³æœµé•¿é•¿ï¼Œæˆ‘æ˜¯å°å…”å­ï¼' },
    D:{ name:'å°ç†Š', intro:'æˆ‘èƒ–ä¹ä¹å¾ˆæ¸©æŸ”ï¼Œæˆ‘æ˜¯å°ç†Šï¼' },
    E:{ name:'å°ç‹ç‹¸', intro:'æˆ‘èªæ˜æœºçµï¼Œå°¾å·´å¤§å¤§ï¼Œæˆ‘æ˜¯å°ç‹ç‹¸ï¼' },
    F:{ name:'å°ç†ŠçŒ«', intro:'æˆ‘çˆ±ç«¹å­ï¼Œåœ†æ»šæ»šï¼Œæˆ‘æ˜¯å°ç†ŠçŒ«ï¼' },
    G:{ name:'å°é’è›™', intro:'æˆ‘ä¼šè·³è·³ï¼Œä¹Ÿä¼šæ¸¸æ³³ï¼Œæˆ‘æ˜¯å°é’è›™ï¼' },
    H:{ name:'å°çŒª', intro:'æˆ‘çˆ±åƒä¹Ÿçˆ±ç¡ï¼Œæˆ‘æ˜¯å°çŒªçŒªï¼' },
    I:{ name:'å°ç‹®å­', intro:'æˆ‘æ˜¯è‰åŸå°ç‹å­ï¼Œæˆ‘æ˜¯å°ç‹®å­ï¼' },
    J:{ name:'å°è€è™', intro:'æˆ‘æœ‰æ¡çº¹ï¼Œå‹‡æ•¢åˆå¸…ï¼Œæˆ‘æ˜¯å°è€è™ï¼' },
    K:{ name:'å°ç‰›', intro:'æˆ‘ä¼šæ…¢æ…¢èµ°ï¼Œä¹Ÿä¼šåƒè‰ï¼Œæˆ‘æ˜¯å°ç‰›ï¼' },
    L:{ name:'é•¿é¢ˆé¹¿', intro:'æˆ‘è„–å­é•¿é•¿ï¼Œèƒ½åƒåˆ°é«˜é«˜çš„å¶å­ï¼' },
    M:{ name:'å°çŒ´', intro:'æˆ‘ä¼šçˆ¬æ ‘çˆ±ç©è€ï¼Œæˆ‘æ˜¯å°çŒ´å­ï¼' },
    N:{ name:'å°ä¼é¹…', intro:'æˆ‘ç©¿å°è¥¿è£…ï¼Œæ‘‡æ‘‡æ‘†æ‘†ï¼Œæˆ‘æ˜¯å°ä¼é¹…ï¼' },
    O:{ name:'çŒ«å¤´é¹°', intro:'æˆ‘æ™šä¸Šæ›´ç²¾ç¥ï¼Œæˆ‘æ˜¯çŒ«å¤´é¹°ï¼' },
    P:{ name:'å°é¸­å­', intro:'æˆ‘ä¼šæ¸¸æ³³å˜å˜å«ï¼Œæˆ‘æ˜¯å°é¸­å­ï¼' },
    Q:{ name:'å°åˆºçŒ¬', intro:'æˆ‘æœ‰å°åˆºåˆºï¼Œä½†æˆ‘å¾ˆå¯çˆ±ï¼Œæˆ‘æ˜¯å°åˆºçŒ¬ï¼' },
    R:{ name:'å°æ²³é©¬', intro:'æˆ‘åœ¨æ°´é‡Œæ³¡æ¾¡æœ€å¼€å¿ƒï¼Œæˆ‘æ˜¯å°æ²³é©¬ï¼' },
    S:{ name:'å°æµ·è±¹', intro:'æˆ‘ä¼šé¡¶çƒï¼Œä¹Ÿçˆ±é¼“æŒï¼Œæˆ‘æ˜¯å°æµ·è±¹ï¼' },
    T:{ name:'å°è±¡', intro:'æˆ‘é¼»å­é•¿é•¿ä¼šå–·æ°´ï¼Œæˆ‘æ˜¯å°è±¡ï¼' },
    U:{ name:'ç‹¬è§’å…½', intro:'æˆ‘æœ‰å°è§’è§’ï¼Œåƒç«¥è¯ä¸€æ ·ï¼Œæˆ‘æ˜¯ç‹¬è§’å…½ï¼' },
    V:{ name:'å°é²¸é±¼', intro:'æˆ‘åœ¨æµ·é‡Œå”±æ­Œï¼Œæˆ‘æ˜¯å°é²¸é±¼ï¼' },
    W:{ name:'å°ä¹Œé¾Ÿ', intro:'æˆ‘èµ°å¾—æ…¢ï¼Œä½†å¾ˆåŠªåŠ›ï¼Œæˆ‘æ˜¯å°ä¹Œé¾Ÿï¼' },
    X:{ name:'æ–‘é©¬', intro:'æˆ‘æœ‰é»‘ç™½æ¡çº¹ï¼Œæˆ‘æ˜¯æ–‘é©¬ï¼' },
    Y:{ name:'å°é±¼', intro:'æˆ‘åœ¨æ°´é‡Œåæ³¡æ³¡ï¼Œæˆ‘æ˜¯å°é±¼ï¼' },
    Z:{ name:'å°æé¾™', intro:'æˆ‘æ˜¯è¿œå¤å°ä¼™ä¼´ï¼Œæˆ‘æ˜¯å°æé¾™ï¼' },
  };

  const STORE_KEY = 'storybook_photo_wall_static_v1';
  const state = { cards:{}, soundOn:true, voiceOn:true };

  function updateProgress(){
    const c = Object.keys(state.cards).length;
    countText.textContent = `${c}/26`;
    barFill.style.width = `${Math.round((c/26)*100)}%`;
    if(c>0) hint.classList.add('hidden'); else hint.classList.remove('hidden');
  }
  function save(){ try{ localStorage.setItem(STORE_KEY, JSON.stringify(state)); }catch(e){} }
  function load(){
    try{
      const raw = localStorage.getItem(STORE_KEY);
      if(!raw) return;
      const data = JSON.parse(raw);
      if(!data || typeof data!=='object') return;
      state.cards = data.cards || {};
      state.soundOn = data.soundOn !== false;
      state.voiceOn = data.voiceOn !== false;
    }catch(e){}
  }
  function clearAll(){
    state.cards = {};
    try{ localStorage.removeItem(STORE_KEY); }catch(e){}
  }

  // æ‹Ÿå£°
  let audioCtx = null;
  function ensureAudio(){
    if(!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    if(audioCtx.state === 'suspended') audioCtx.resume();
  }
  function gainVal(){ return (Number(volEl.value)/100) * 0.12; }
  function playSfx(letter){
    if(!state.soundOn) return;
    ensureAudio();
    const t0 = audioCtx.currentTime;
    const g = audioCtx.createGain();
    g.gain.setValueAtTime(0.0001, t0);
    g.gain.exponentialRampToValueAtTime(gainVal(), t0 + 0.01);
    g.gain.exponentialRampToValueAtTime(0.0001, t0 + 0.28);
    g.connect(audioCtx.destination);

    const o = audioCtx.createOscillator();
    o.type = 'sine';
    const idx = (letter.charCodeAt(0)-65+26)%26;
    const base = 260 + idx * 8;
    o.frequency.setValueAtTime(base+240, t0);
    o.frequency.exponentialRampToValueAtTime(base+140, t0+0.12);
    o.frequency.exponentialRampToValueAtTime(base+200, t0+0.26);
    o.connect(g);
    o.start(t0);
    o.stop(t0+0.30);
  }

  // è¯­éŸ³ä»‹ç»
  function speak(text){
    if(!state.voiceOn) return;
    try{
      speechSynthesis.cancel();
      const u = new SpeechSynthesisUtterance(text);
      u.lang = 'zh-CN';
      u.rate = 0.95;
      u.pitch = 1.15;
      u.volume = Math.min(1, Math.max(0, Number(volEl.value)/100));
      speechSynthesis.speak(u);
    }catch(e){}
  }

  // æ ¸å¿ƒï¼šè®¾ç½®å›¾ç‰‡ï¼ˆåªç”¨ images/X1.jpgï¼‰
  function setCard(letter){
    const info = Animals[letter];
    if(!info) return;

    const card = document.getElementById(`card-${letter}`);
    const img  = document.getElementById(`img-${letter}`);
    const msg  = document.getElementById(`msg-${letter}`);
    const name = document.getElementById(`name-${letter}`);
    if(!card || !img || !msg || !name) return;

    card.classList.add('show');
    name.textContent = info.name;

    // ç‚¹å‡»å¡ç‰‡ä¹Ÿå¯è¯»
    card.onclick = () => { playSfx(letter); speak(info.intro); };

    msg.classList.remove('show');
    img.style.display = '';

    const url = `images/${letter}1.jpg?v=${Date.now()}`;
    img.onload = () => {
      msg.classList.remove('show');
      img.style.display = '';
    };
    img.onerror = () => {
      img.style.display = 'none';
      msg.textContent = `æ‰¾ä¸åˆ°å›¾ç‰‡ï¼šimages/${letter}1.jpg\nè¯·ç¡®è®¤ images æ–‡ä»¶å¤¹ä¸ YoYo.html åŒçº§\nä¸”æ–‡ä»¶åæ˜¯ ${letter}1.jpgï¼ˆå¤§å†™ï¼‰`;
      msg.classList.add('show');
    };
    img.src = url;
  }

  function setCard(letter, isNew=false){
  const info = Animals[letter];
  if(!info) return;

  const card = document.getElementById(`card-${letter}`);
  const img  = document.getElementById(`img-${letter}`);
  const msg  = document.getElementById(`msg-${letter}`);
  const name = document.getElementById(`name-${letter}`);
  if(!card || !img || !msg || !name) return;

  card.classList.add('show');
  name.textContent = info.name;

  // é«˜äº®é€»è¾‘ï¼šè®¾ç½® activeï¼Œå¹¶è®©å…¶å®ƒå¡ç‰‡å˜æš—
  document.querySelectorAll('.card.active').forEach(el => el.classList.remove('active'));
  card.classList.add('active');
  grid.classList.add('dim');

  // è‡ªåŠ¨å±…ä¸­ï¼ˆæ»šåŠ¨åˆ°å¡ç‰‡ä½ç½®ï¼‰
  card.scrollIntoView({ behavior:'smooth', block:'center', inline:'center' });

  // æ–°è´´å¡ç‰‡ï¼šå¼¹ä¸€ä¸‹
  if (isNew) {
    card.classList.remove('pop');
    // è§¦å‘é‡å¯åŠ¨ç”»
    void card.offsetWidth;
    card.classList.add('pop');
    setTimeout(()=>card.classList.remove('pop'), 650);
  }

  // ç‚¹å‡»å¡ç‰‡ï¼šä¸´æ—¶æ”¾å¤§ + è¯»ä»‹ç»ï¼ˆå«æ‹Ÿå£°ï¼‰
  card.onclick = () => {
    // zoom åŠ¨ç”»
    card.classList.add('zoom');
    setTimeout(()=>card.classList.remove('zoom'), 320);

    playSfx(letter);
    speak(info.intro);

    // ç‚¹å‡»ä¹Ÿä½œä¸ºå½“å‰é«˜äº®
    document.querySelectorAll('.card.active').forEach(el => el.classList.remove('active'));
    card.classList.add('active');
    grid.classList.add('dim');
    card.scrollIntoView({ behavior:'smooth', block:'center', inline:'center' });
  };

  // å›¾ç‰‡åŠ è½½ï¼ˆåªç”¨ images/X1.jpgï¼‰
  msg.classList.remove('show');
  img.style.display = '';

  const url = `images/${letter}1.jpg?v=${Date.now()}`;
  img.onload = () => {
    msg.classList.remove('show');
    img.style.display = '';
  };
  img.onerror = () => {
    img.style.display = 'none';
    msg.textContent = `æ‰¾ä¸åˆ°å›¾ç‰‡ï¼šimages/${letter}1.jpg\nè¯·ç¡®è®¤ images æ–‡ä»¶å¤¹ä¸ YoYo.html åŒçº§\nä¸”æ–‡ä»¶åæ˜¯ ${letter}1.jpgï¼ˆå¤§å†™ï¼‰`;
    msg.classList.add('show');
  };
  img.src = url;
}

  function spawnOrFlip(letter){
    const info = Animals[letter];
    if(!info) return;

    const isNew = !state.cards[letter];
    if(isNew) state.cards[letter] = { shown:true };

    setCard(letter, isNew);

    playSfx(letter);
    badge.textContent = `${letter} - ${info.name}`;
    badge.classList.add('show');
    clearTimeout(badge._t);
    badge._t = setTimeout(()=>badge.classList.remove('show'), 900);

    speak(info.intro);
    save();
    updateProgress();
  }


  // æ¢å¤å·²ä¿å­˜
  function restore(){
    for(const letter in state.cards){
      if(Animals[letter]) setCard(letter);
    }
    updateProgress();
  }

  // é”®ç›˜
  let lastKeyAt = 0;
  window.addEventListener('keydown', (e) => {
    if (e.key === 'Escape') {
      clearAll();
      for(let i=0;i<26;i++){
        const L = String.fromCharCode(65+i);
        document.getElementById(`card-${L}`).classList.remove('show');
      }
      updateProgress();
      return;
    }
    const now = performance.now();
    if (now - lastKeyAt < 90) return;
    lastKeyAt = now;

    const L = (e.key || '').toUpperCase();
    if (L.length === 1 && L >= 'A' && L <= 'Z') spawnOrFlip(L);
  }, { passive:false });

  // æŒ‰é’®
  const soundBtn = document.getElementById('soundBtn');
  const voiceBtn = document.getElementById('voiceBtn');

  document.getElementById('resetBtn').addEventListener('click', () => {
    clearAll();
    for(let i=0;i<26;i++){
      const L = String.fromCharCode(65+i);
      document.getElementById(`card-${L}`).classList.remove('show');
    }
    updateProgress();
    try{ speechSynthesis.cancel(); }catch(e){}
  });

  soundBtn.addEventListener('click', () => {
    state.soundOn = !state.soundOn;
    soundBtn.textContent = state.soundOn ? 'æ‹Ÿå£°ï¼šå¼€' : 'æ‹Ÿå£°ï¼šå…³';
    save();
  });

  voiceBtn.addEventListener('click', () => {
    state.voiceOn = !state.voiceOn;
    voiceBtn.textContent = state.voiceOn ? 'ä»‹ç»ï¼šå¼€' : 'ä»‹ç»ï¼šå…³';
    if(!state.voiceOn){ try{ speechSynthesis.cancel(); }catch(e){} }
    save();
  });

  // å¯åŠ¨
  load();
  soundBtn.textContent = state.soundOn ? 'æ‹Ÿå£°ï¼šå¼€' : 'æ‹Ÿå£°ï¼šå…³';
  voiceBtn.textContent = state.voiceOn ? 'ä»‹ç»ï¼šå¼€' : 'ä»‹ç»ï¼šå…³';
  restore();
})();
</script>
</body>
</html>
